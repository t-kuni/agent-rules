# リサーチプロンプト

## 何をリサーチするか

このリポジトリのAGENTルールを他のリポジトリで使いたいときに、このリポジトリからコピーしてきて各ツール向けに展開するのを自動化したい。この実現方法を検討してほしい。

サポートするツールは以下：
- Cursor IDE
- claude code
- codex cli
- gemini cli

setup-cursor.sh などのセットアップスクリプトを作る方向になるかなと思っている。

## プロジェクトの概要

このリポジトリ（agent-rules）は、SDD（仕様駆動開発）のためのAI AGENT向けのルール集（Skillsなど）を管理するテンプレートリポジトリです。

### 主な用途
- 複数のAI開発支援ツール（Cursor IDE、Claude Code、Codex CLI、Gemini CLIなど）で共通して使えるルール・スキルを一元管理
- 各プロジェクトにこれらのルールをコピーして使用する

### ワークフロー
タスクをトリガーするプロンプトを使用し、以下のようなフローで開発を進める：
- リサーチプロンプト作成
- 仕様検討
- タスク洗い出し
- タスク遂行
- バグ調査
- テストエラー解析

## 現状の構造

### ディレクトリ構成

```
agent-rules/
├── original/              # 原本のスキル定義（13個のスキル）
│   ├── AGENTS.md
│   ├── guideline-alert/
│   ├── guideline-code/
│   ├── guideline-research/
│   ├── guideline-specs/
│   ├── guideline-tasks/
│   ├── guideline-test/
│   ├── tasks-bug-fix/
│   ├── tasks-exec-research/
│   ├── tasks-exec-tasks/
│   ├── tasks-make-research-prompt/
│   ├── tasks-make-spec/
│   ├── tasks-make-task-list/
│   └── tasks-test-error/
├── research/              # リサーチレポート格納ディレクトリ
├── CLAUDE.md              # プロジェクト説明
├── README.md              # 使い方ガイド
└── flowchart.png          # 運用フローチャート
```

### 各ツールのフォーマット違い

#### 1. Original（原本）
- **場所**: `original/[skill-name]/SKILL.md`
- **フォーマット**:
  ```markdown
  ---
  name: skill-name
  description: スキルの説明
  ---

  [実際のルール内容]
  ```

#### 2. Cursor IDE
- **現状**: フォーマット調査が必要

#### 3. Claude Code
- **現状**: フォーマット調査が必要

#### 4. Codex CLI
- **現状**: フォーマット調査が必要

#### 5. Gemini CLI
- **現状**: フォーマット調査が必要

### 重要な制約事項

- **ファイル内容は書き換えない**: 原本（`original/`）のファイルをそのまま各ツール用のディレクトリにコピーする
  - ファイル名の変更（例: `SKILL.md` → `.cursorrules`）は許容される
  - ファイルの内容を書き換える必要があるツールはサポート対象外とする
- **シンボリックリンクは使用しない**: ファイルのコピーで対応する
- **リファレンスファイルは作成しない**: 「原本を参照してください」といった内容のファイルは作成しない

## リサーチ観点

### 1. セットアップスクリプトのアーキテクチャ設計 ⚠ 意思決定が必要です

**選択肢A: ツールごとに独立したスクリプト（推奨）**
- `setup-claude.sh`, `setup-cursor.sh`, `setup-codex.sh`, `setup-gemini.sh` のように分割
- メリット: 各ツールの設定が独立、メンテナンスしやすい、必要なものだけ実行可能
- デメリット: スクリプト数が増える

**選択肢B: 統合スクリプト**
- `setup.sh --tool cursor` のように単一スクリプトで引数で切り替え
- メリット: スクリプト数が少ない、共通ロジックをまとめやすい
- デメリット: 複雑になりやすい、一部のツールだけ更新する際に影響範囲が大きい

**選択肢C: Makefileベース**
- `make setup-cursor`, `make setup-claude` のようにMakefileで管理
- メリット: タスクランナーとして標準的、依存関係の管理が容易
- デメリット: Makefileの知識が必要

### 2. ファイル変換の実装方法 ⚠ 意思決定が必要です

**選択肢A: シェルスクリプト（sed/awk）（推奨）**
- メリット: 依存関係が少ない、Linux/macOSで標準的に利用可能
- デメリット: 複雑な変換は記述が難しい

**選択肢B: Python/Node.jsスクリプト**
- メリット: 複雑な変換ロジックを書きやすい、YAML/Markdownパーサーが充実
- デメリット: 実行環境に依存関係が必要

**選択肢C: テンプレートエンジン（envsubst, jinja2等）**
- メリット: 可読性が高い、保守しやすい
- デメリット: 追加のツールが必要

### 3. 原本からの変換ルール定義

originalフォルダから各ツール形式への変換ルールを定義する必要があります。

**基本方針**:
- ファイルの内容はそのままコピーする
- ファイル名の変更は許容される（例: `SKILL.md` → 各ツール固有の名前）
- ディレクトリ構造の変更も許容される
- ファイルの内容を書き換える必要があるツールはサポート対象外

**各ツール向け変換**:

以下の調査が必要:
- 配置場所（ディレクトリ構造）
- ファイル名・拡張子
- ファイル内容の変更が必要か（必要な場合はサポート対象外）

対象ツール:
- Cursor IDE
- Claude Code
- Codex CLI
- Gemini CLI

### 4. 設定ファイルの配置先 ⚠ 意思決定が必要です

**選択肢A: 各ツールの標準的な配置場所に従う（推奨）**
- 各ツールが期待する標準的なディレクトリ構造に従ってコピー
- メリット: ツールがそのまま認識できる、追加設定不要
- デメリット: ツールごとに配置場所が異なる

**選択肢B: .config/ディレクトリに集約**
- `.config/cursor/`, `.config/codex/` のように集約
- メリット: ルートディレクトリがスッキリ
- デメリット: ツールが標準で期待する場所と異なる可能性、追加設定が必要

### 5. 更新の取り込み方法 ⚠ 意思決定が必要です

**選択肢A: 上書きコピー（推奨）**
- 再度セットアップスクリプトを実行して上書き
- メリット: シンプル、最新版を確実に取得
- デメリット: カスタマイズした内容が失われる

**選択肢B: Git submodule**
- agent-rulesをsubmoduleとして組み込み、展開スクリプトのみ実行
- メリット: 更新が容易、バージョン管理が明確
- デメリット: submoduleの運用が複雑

**選択肢C: パッケージマネージャー化**
- npmパッケージやGitHub Releasesとして配布
- メリット: バージョン管理が明確、更新が簡単
- デメリット: 初期セットアップのコストが高い

### 6. カスタマイズ可能性の考慮

プロジェクト固有のカスタマイズをどう扱うか。

**選択肢A: 上書き前提で、カスタマイズは別ファイル**
- 標準ルールとプロジェクト固有ルールを分離
- メリット: 更新時に競合しない
- デメリット: ファイル数が増える

**選択肢B: マージ機能を提供**
- セットアップスクリプトがマージオプションを持つ
- メリット: 柔軟性が高い
- デメリット: 実装が複雑

### 7. 各ツールのフォーマット調査

Claude Codeのフォーマットは判明していますが、Cursor IDE、Codex CLI、Gemini CLIのルール定義フォーマットを調査する必要があります。

各ツールについて以下を確認：
- 公式ドキュメントの確認
- 設定ファイルの形式（JSON/YAML/Markdown等）
- 配置場所（ディレクトリ構造）
- ファイル拡張子
- フロントマターやメタデータの形式
- スキル/ルールの登録・読み込み方法

### 8. エラーハンドリングとバリデーション

セットアップスクリプトに含めるべきチェック機能。

- 必須ディレクトリ（originalフォルダ）の存在確認
- 対象リポジトリが既にセットアップ済みかの確認
- バックアップ機能の有無
- ドライラン（--dry-run）オプションの提供

### 9. ドキュメント整備

- 各セットアップスクリプトの使い方
- トラブルシューティングガイド
- 各ツール向けのREADME作成
- アンインストール方法

### 10. CI/CD連携の可能性

- セットアップスクリプトのテスト自動化
- 各ツールでの動作確認
- フォーマット変換の正確性検証
